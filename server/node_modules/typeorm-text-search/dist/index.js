"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.textSearchByFields = void 0;
const typeorm_1 = require("typeorm");
const build_term_factory_1 = require("./build-term-factory");
const constants_1 = require("./constants");
const build_tokens_factory_1 = require("./build-tokens-factory");
function textSearchByFields(builder, search, fields) {
    if (isWholePhraseSearch(search)) {
        const term = search.slice(1, -1);
        builder.andWhere(new typeorm_1.Brackets(build_term_factory_1.buildTermFactory(term, fields)));
    }
    else {
        const tokens = prepareTokens(search);
        builder.andWhere(new typeorm_1.Brackets(build_tokens_factory_1.buildTokensFactory(tokens, fields)));
    }
}
exports.textSearchByFields = textSearchByFields;
function isWholePhraseSearch(search) {
    return search.startsWith(constants_1.DOUBLE_QUOTE) && search.endsWith(constants_1.DOUBLE_QUOTE);
}
function prepareTokens(search) {
    return search.split(constants_1.DELIMITER);
}
